<%- include('partials/header') %>
<h1>Modificar Registro</h1>

<form action="/modificar/<%= registro._id %>?code=9999" method="POST">
  <input type="hidden" name="_method" value="PUT">

  <div class="form-group">
    <label for="idTicket">ID Ticket</label>
    <input type="text" id="idTicket" name="idTicket" class="form-control" value="<%= registro.idTicket %>" readonly>
  </div>

  <div class="form-group">
    <label for="fecha">Fecha</label>
    <input type="date" id="fecha" name="fecha" class="form-control" value="<%= registro.fecha %>" required>
  </div>

  <div class="form-group">
    <label for="usuario">Usuario</label>
    <input type="text" id="usuario" name="usuario" class="form-control" value="<%= registro.usuario %>" required>
  </div>

  <div class="form-group">
    <label for="cargaPara">Carga para</label>
    <select id="cargaPara" name="cargaPara" class="form-control" required onchange="toggleSocio()">
      <option value="AMH" <%= registro.cargaPara==='AMH' ? 'selected':'' %>>AMH</option>
      <option value="SOCIO" <%= registro.cargaPara==='SOCIO' ? 'selected':'' %>>SOCIO</option>
    </select>
  </div>

  <div id="socioField" class="form-group" style="display:<%= registro.cargaPara==='SOCIO' ? 'block':'none' %>;">
    <label for="socio">Nombre del Socio</label>
    <input type="text" id="socio" name="socio" class="form-control" value="<%= registro.socio || '' %>">
  </div>

  <div class="form-group">
    <label for="pesadaPara">Pesada para</label>
    <select id="pesadaPara" name="pesadaPara" class="form-control" required onchange="toggleForm()">
      <option value="TARA" <%= registro.pesadaPara==='TARA' ? 'selected':'' %>>TARA</option>
      <option value="REGULADA" <%= registro.pesadaPara==='REGULADA' ? 'selected':'' %>>REGULADA</option>
    </select>
  </div>

  <!-- TARA -->
  <div id="taraFields" style="display:<%= registro.pesadaPara==='TARA' ? 'block':'none' %>;">
    <div class="form-group">
      <label for="transporte">Transporte</label>
      <input type="text" id="transporte" name="transporte" class="form-control" value="<%= registro.transporte || '' %>">
    </div>
    <div class="form-group">
      <label for="patentes">Patentes</label>
      <input type="text" id="patentes" name="patentes" class="form-control" value="<%= registro.patentes %>">
    </div>
    <div class="form-group">
      <label for="chofer">Chofer</label>
      <input type="text" id="chofer" name="chofer" class="form-control" value="<%= registro.chofer || '' %>">
    </div>
    <div class="form-group">
      <label for="brutoEstimado">Bruto Estimado (kg)</label>
      <select id="brutoEstimado" name="brutoEstimado" class="form-control">
        <option value="45000" <%= registro.brutoEstimado===45000 ? 'selected':'' %>>45000 kg</option>
        <option value="52500" <%= registro.brutoEstimado===52500 ? 'selected':'' %>>52500 kg</option>
        <option value="55000" <%= registro.brutoEstimado===55000 ? 'selected':'' %>>55000 kg</option>
      </select>
    </div>
    <div class="form-group">
      <label for="tara">Tara (kg)</label>
      <input type="number" id="tara" name="tara" class="form-control" value="<%= registro.tara || 0 %>" required>
    </div>
  </div>

  <!-- REGULADA -->
  <div id="reguladaFields" style="display:<%= registro.pesadaPara==='REGULADA' ? 'block':'none' %>;">
    <div class="form-group">
      <label for="campo">Campo</label>
      <select id="campo" name="campo" class="form-control" required>
        <option value="">Seleccione un campo</option>
        <% (campos || []).forEach(c => { %>
          <option value="<%= c %>" <%= registro.campo===c ? 'selected':'' %>><%= c %></option>
        <% }) %>
      </select>
    </div>

    <div class="form-group">
      <label for="grano">Grano</label>
      <input type="text" id="grano" name="grano" class="form-control" value="<%= registro.grano || '' %>">
      <!-- (si querés hacerlo select dinámico, podemos replicar el de registro.ejs) -->
    </div>

    <div class="form-group">
      <label for="lote">Lote</label>
      <input type="text" id="lote" name="lote" class="form-control" value="<%= registro.lote || '' %>">
    </div>

    <div class="form-group">
      <label for="cargoDe">Cargo de</label>
      <select id="cargoDe" name="cargoDe" class="form-control" required onchange="toggleCargo()">
        <option value="SILOBOLSA" <%= registro.cargoDe==='SILOBOLSA' ? 'selected':'' %>>Silobolsa</option>
        <option value="CONTRATISTA" <%= registro.cargoDe==='CONTRATISTA' ? 'selected':'' %>>Contratista</option>
      </select>
    </div>

    <div id="silobolsaField" class="form-group" style="display:<%= registro.cargoDe==='SILOBOLSA' ? 'block':'none' %>;">
      <label for="silobolsa">Número Silobolsa</label>
      <input type="text" id="silobolsa" name="silobolsa" class="form-control" value="<%= registro.silobolsa || '' %>">
    </div>

    <div id="contratistaField" class="form-group" style="display:<%= registro.cargoDe==='CONTRATISTA' ? 'block':'none' %>;">
      <label for="contratista">Nombre Contratista</label>
      <input type="text" id="contratista" name="contratista" class="form-control" value="<%= registro.contratista || '' %>">
    </div>

    <div class="form-group">
      <label for="bruto">Bruto (kg)</label>
      <input type="number" id="bruto" name="bruto" class="form-control" value="<%= registro.bruto || 0 %>">
    </div>
  </div>

  <button type="submit" class="btn btn-primary">Guardar Cambios</button>
</form>

<script>
  function toggleForm() {
    const v = document.getElementById('pesadaPara').value;
    document.getElementById('taraFields').style.display     = v === 'TARA' ? 'block' : 'none';
    document.getElementById('reguladaFields').style.display = v === 'REGULADA' ? 'block' : 'none';
  }
  function toggleSocio() {
    const v = document.getElementById('cargaPara').value;
    document.getElementById('socioField').style.display = v === 'SOCIO' ? 'block' : 'none';
  }
  function toggleCargo() {
    const v = document.getElementById('cargoDe').value;
    document.getElementById('silobolsaField').style.display   = v === 'SILOBOLSA' ? 'block' : 'none';
    document.getElementById('contratistaField').style.display = v === 'CONTRATISTA' ? 'block' : 'none';
  }

  toggleForm(); toggleSocio(); toggleCargo();
</script>

<%- include('partials/footer') %>
